## LAB 03.10

### Advanced Level

To register external node we need to propagate kubeconfig and ca.crt to remote host.

Server address in kubeconfig should be updated with codespace URL for apiserver port. Need to make sure that codespace port is public and uses https.
```yaml
apiVersion: v1
clusters:
- cluster:
    insecure-skip-tls-verify: true
    server: https://cuddly-eureka-pjgqv775ww4fwwj-6443.app.github.dev
  name: test-env
contexts:
- context:
    cluster: test-env
    namespace: default
    user: test-user
  name: test-context
current-context: test-context
kind: Config
preferences: {}
users:
- name: test-user
  user:
    token: "1234567890"
```

```bash
$ kubectl get nodes -o wide
NAME                       STATUS   ROLES    AGE     VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION         CONTAINER-RUNTIME
codespaces-24f8aa          Ready    <none>   27m     v1.30.0   10.0.0.90     <none>        Ubuntu 24.04.2 LTS               6.8.0-1030-azure       containerd://2.0.5
instance-20251005-171521   Ready    <none>   7m24s   v1.30.0   10.128.0.3    <none>        Debian GNU/Linux 12 (bookworm)   6.1.0-39-cloud-amd64   containerd://2.0.5
```

### Max Level

```bash
# Create certificates directory if it doesn't exist
sudo mkdir -p /var/lib/kubelet/pki

# Generate private key
sudo openssl genrsa -out /var/lib/kubelet/pki/kubelet.key 2048

# Generate CSR (replace NODE_NAME with your actual node name)
NODE_NAME=$(hostname)
sudo openssl req -new -key /var/lib/kubelet/pki/kubelet.key \
  -out /var/lib/kubelet/pki/kubelet.csr \
  -subj "/O=system:nodes/CN=system:node:${NODE_NAME}"
```
